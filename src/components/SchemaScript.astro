---
import site from '../../content/global.json';

export interface Crumb {
  name: string;
  url: string;
}

interface Props {
  pageUrl?: string;
  breadcrumb?: Crumb[];
  faq?: { question: string; answer: string }[];
  ogImage?: string;
}

const { pageUrl, breadcrumb = [], faq = [], ogImage } = Astro.props as Props;

const resolvedUrl = (pageUrl ?? 'https://the-jungle-growshop-dortmund.github.io/').trim();

const localBusiness = {
  '@context': 'https://schema.org',
  '@type': 'LocalBusiness',
  name: site.brand,
  url: resolvedUrl,
  telephone: site.phone_display,
  image: ogImage ?? '/og-cover.png',
  address: {
    '@type': 'PostalAddress',
    streetAddress: 'Eberstr. 18',
    addressLocality: 'Dortmund',
    postalCode: '44145',
    addressCountry: 'DE'
  },
  openingHoursSpecification: [
    {
      '@type': 'OpeningHoursSpecification',
      dayOfWeek: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],
      opens: '10:00',
      closes: '20:00'
    }
  ]
};

const crumbs = breadcrumb.length
  ? [
      {
        '@context': 'https://schema.org',
        '@type': 'BreadcrumbList',
        itemListElement: breadcrumb.map((crumbItem, index) => ({
          '@type': 'ListItem',
          position: index + 1,
          name: crumbItem.name,
          item: crumbItem.url.trim()
        }))
      }
    ]
  : [];

const faqSchema = faq.length
  ? [
      {
        '@context': 'https://schema.org',
        '@type': 'FAQPage',
        mainEntity: faq.map((item) => ({
          '@type': 'Question',
          name: item.question,
          acceptedAnswer: {
            '@type': 'Answer',
            text: item.answer
          }
        }))
      }
    ]
  : [];

const schemas = [localBusiness, ...crumbs, ...faqSchema];
const json = JSON.stringify(schemas, null, 2);
---

<script type="application/ld+json" set:html={json}></script>
