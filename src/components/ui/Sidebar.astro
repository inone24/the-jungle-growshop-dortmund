---
import { SidebarProvider, Sidebar, SidebarMobile, SidebarTrigger } from "@/islands/ui/Sidebar.client";
import { withBase } from "@/lib/url";

const base = import.meta.env.BASE_URL;
const { menu = [], side = "left" } = Astro.props as {
  side?: "left" | "right";
  menu: { label: string; href?: string }[];
};

const normalized = menu.map((entry) => ({
  ...entry,
  href: withBase(entry.href, base),
}));
---
<noscript>
  <aside class={`fixed inset-y-0 ${side === "right" ? "right-0" : "left-0"} w-64 ui-glass p-4 overflow-auto`}>
    <nav aria-label="SeitenmenÃ¼">
      <ul class="space-y-2">
        {normalized.map((link) => (
          <li key={link.label}>
            {link.href ? (
              <a class="text-white/90 hover:text-white" href={link.href}>{link.label}</a>
            ) : (
              <span class="text-white/70">{link.label}</span>
            )}
          </li>
        ))}
      </ul>
    </nav>
  </aside>
</noscript>
<SidebarProvider client:idle>
  <div class="md:hidden fixed top-2 left-2 z-50">
    <SidebarTrigger />
  </div>
  <SidebarMobile side={side}>
    <nav class="p-4">
      <ul class="space-y-2">
        {normalized.map((link) => (
          <li key={link.label}>
            {link.href ? (
              <a class="text-white/90 hover:text-white" href={link.href}>{link.label}</a>
            ) : (
              <span class="text-white/70">{link.label}</span>
            )}
          </li>
        ))}
      </ul>
    </nav>
  </SidebarMobile>
  <Sidebar side={side}>
    <nav class="p-4">
      <ul class="space-y-2">
        {normalized.map((link) => (
          <li key={link.label}>
            {link.href ? (
              <a class="text-white/90 hover:text-white" href={link.href}>{link.label}</a>
            ) : (
              <span class="text-white/70">{link.label}</span>
            )}
          </li>
        ))}
      </ul>
    </nav>
  </Sidebar>
</SidebarProvider>
